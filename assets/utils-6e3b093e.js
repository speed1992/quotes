import{S as STATIC_OPTIONS,f as retryTenTimes,G as API_ENDPOINTS}from"./index-9f2e32b3.js";import{g as getPhilosopherObjectIndex,e as bringIntoOriginalOrder,f as bringIntoAlphabeticalOrder,h as isObjEmpty,a as getPhilosopherQuotes,l as lazyLoadAsset}from"./commonUtils-9c9ddae1.js";import{w as worker}from"./worker-7ead2ab3.js";const MAX_RECENT_PHILOSOPHERS=5,CACHE_TIME_IN_DAYS=1,isCacheExpired=e=>{e=new Date(e);const t=new Date().getTime()-e.getTime();return Math.floor(t/(1e3*60*60*24))>=CACHE_TIME_IN_DAYS},LATEST="latest",ALPHABETICAL="alphabetical",merge=(e,n)=>{let t=JSON.parse(JSON.stringify(n));return t.forEach((a,o)=>{const r=getPhilosopherObjectIndex(a.value,e);r!==-1&&(t[o].quotes=e[r].quotes)}),t},addResponseOptionsDataIntoRedux=({newOptions:e,oldOptions:n,oldOriginalOptions:t,setOptions:a,setOriginalOptions:o,sorting:r})=>{const l=[...STATIC_OPTIONS,...e];let s=merge(n,[...l]);r===LATEST?s=bringIntoOriginalOrder(l,s):r===ALPHABETICAL&&(s=bringIntoAlphabeticalOrder(s)),a([...s]),o(l)};function getStorageValue(e,n){const t=localStorage.getItem(e),a=JSON.parse(t);return a===void 0||a==="undefined"||a==="null"||a===null?n:a}const removeReadData=({index:e,currentPhilosopher:n,markedMode:t,markedQuotes:a={},setMarkedQuotes:o,currentData:r,setCurrentData:l})=>{let s=JSON.parse(JSON.stringify(a)),i=[];const d=`${n}-MARKED_AS_READ`;i=getStorageValue(d,[]),a&&a[n]!==void 0&&(i=[...i,...a[n]]),i=[...new Set(i)],e&&i.push(e),s[n]=i,o(s);const f=r.filter(({id:u},c)=>i.indexOf(u)===-1);l(JSON.parse(JSON.stringify(f)))},changeQuotesData=({currentPhilosopher:e,currentData:n,setCurrentData:t,options:a},{markedMode:o=null,markedQuotes:r,setMarkedQuotes:l})=>{n&&t(n),o!==void 0&&o&&removeReadData({currentPhilosopher:e,markedMode:o,markedQuotes:r,setMarkedQuotes:l,currentData:n,setCurrentData:t})},getPhilosopherFullName=({currentPhilosopher:e,options:n})=>{const t=n.filter(({value:a})=>e===a);if(!isObjEmpty(t))return t&&t[0].fullName},getPhilosopherFullName_i10n=({currentPhilosopher:e,options:n})=>{const t=n.filter(({value:a})=>e===a);if(!isObjEmpty(t))return t&&t[0].fullNameInOtherLanguages},searchByWordLength=async(start,end,quotes,{markedMode,markedQuotes,setMarkedQuotes},{setCurrentData,currentPhilosopher})=>new Promise(resolve=>{quotes!==void 0&&(typeof start=="string"&&start.trim()===""&&(start=0),worker.postMessage({quotes,end,start,filterName:"wordCountFilter"}),worker.onmessage=event=>{const newData=JSON.parse(eval(`(${JSON.stringify(event.data)})`));changeQuotesData({currentData:newData,setCurrentData,currentPhilosopher},{markedMode,markedQuotes,setMarkedQuotes}),resolve()})});function onPhilosopherSelectChange({philosopher:e,listRef:n,setIsFetching:t,setStart:a,setEnd:o,setSearchText:r,setCurrentPhilosopher:l,currentData:s,setCurrentData:i,options:d,setOptions:f,markedMode:u,markedQuotes:c,setMarkedQuotes:O,scrollPosition:T,setRowsRendered:E,recentPhilosophers:A,setRecentPhilosophers:S}){function g(){A&&S([...new Set([e,...A.slice(0,MAX_RECENT_PHILOSOPHERS-1)])]),l(e),changeQuotesData({philosopher:e,currentData:s,setCurrentData:i,options:d},{markedMode:u,markedQuotes:c,setMarkedQuotes:O}),t(!1)}a(1),o(""),r(""),t(!0),getPhilosopherQuotes({philosopher:e,options:d})?g():lazyLoadAsset(e,{options:d,setOptions:f},[]).then(g)}const onFocusHandler=async({options:e,setOptions:n,isLoggedIn:t,setSyncDate:a,isFetchingOptions:o,setIsFetchingOptions:r,originalOptions:l,setOriginalOptions:s,sorting:i,syncDate:d})=>{if(isCacheExpired(d)||e.length===1){t!==!0&&(a==null||a(Date.now())),r==null||r(!0);let f=await retryTenTimes(()=>fetch(API_ENDPOINTS.STATIC_DATA.STATIC_ASSET_GRAPH));f=await f.json(),addResponseOptionsDataIntoRedux({newOptions:f,oldOptions:e,oldOriginalOptions:l,setOptions:n,setOriginalOptions:s,sorting:i}),r==null||r(!1)}};export{ALPHABETICAL as A,LATEST as L,getPhilosopherFullName_i10n as a,onPhilosopherSelectChange as b,changeQuotesData as c,getPhilosopherFullName as g,onFocusHandler as o,removeReadData as r,searchByWordLength as s};
